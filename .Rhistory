# CAD_Xpert_plot_DOTS <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_DOTS.csv")
# CAD_Xpert_plot_WalkIn <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_WalkIn.csv")
# CAD_Xpert_plot_Referral <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
# CAD_Xpert_plot_New <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
# CAD_Xpert_plot_Old <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
#
#
# SubgroupTable <- rbind(CAD_Xpert_plot_New, CAD_Xpert_plot_Old, CAD_Xpert_plot_Young, CAD_Xpert_plot_Middle, CAD_Xpert_plot_Senior, CAD_Xpert_plot_Referral, CAD_Xpert_plot_DOTS, CAD_Xpert_plot_WalkIn)
# write.csv(SubgroupTable, "Chapter/Subgroup Table/SubgroupTable.csv", row.names = F)
# rm(list=(ls()))
## All
library(precrec)
library(ggplot2)
ROCPRC <- function(dataset){
attr <- attributes(evalmod(scores = dataset$CAD4TB6, labels = dataset$Xpert2Outcome_num))
aucT1 <- c("CAD4TB ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$qXRv2, labels = dataset$Xpert2Outcome_num))
aucT2 <- c("qXR ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$LunitScore, labels = dataset$Xpert2Outcome_num))
aucT3 <- c("Lunit INSIGHT CXR", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$JF1, labels = dataset$Xpert2Outcome_num))
aucT4 <- c("JF CXR-1", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$IF2, labels = dataset$Xpert2Outcome_num))
aucT5 <- c("InferReadDR ", round(attr$auc[4],3))
# return(mmcurves)
# return(autoplot(mmcurves))
aucT <- c(aucT1, aucT2, aucT3, aucT4, aucT5)
return(aucT)
}
l <- ROCPRC(MDF)
all <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
all$subgroup <- "all"
## New only
l <- ROCPRC(New)
New <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
New$subgroup <- "New cases"
## Old only
l <- ROCPRC(Old)
Old <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Old$subgroup <- "Previously treated cases"
## Young
l <- ROCPRC(Young)
Young <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Young$subgroup <- "Young age"
## Middle
l <- ROCPRC(Middle)
Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Middle$subgroup <- "Middle age"
## Senior
l <- ROCPRC(Senior)
Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Senior$subgroup <- "Old age"
## Referral only
l <- ROCPRC(Referral)
Referral <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Referral$subgroup <- "Referred"
## DOTS only
l <- ROCPRC(DOTS)
DOTS <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
DOTS$subgroup <- "DOTS retested"
## Walk-in only
l <- ROCPRC(WalkIn)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "WalkIn"
## Female
l <- ROCPRC(Female)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "Female"
## Male
l <- ROCPRC(Male)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "Male"
#### stratification by age AND prior TB history
# l <- ROCPRC(New_Yong)
# New_Yong <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Yong$subgroup <- "New_Yong"
#
#
# l <- ROCPRC(New_Middle)
# New_Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Middle$subgroup <- "New_Middle"
#
#
# l <- ROCPRC(New_Senior)
# New_Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Senior$subgroup <- "New_Senior"
#
#
#
# l <- ROCPRC(Old_Yong)
# Old_Yong <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Yong$subgroup <- "Old_Yong"
#
#
# l <- ROCPRC(Old_Middle)
# Old_Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Middle$subgroup <- "Old_Middle"
#
#
#
# l <- ROCPRC(Old_Senior)
# Old_Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Senior$subgroup <- "Old_Senior"
#
#
# temp <- rbind(New_Yong, New_Middle, New_Senior, Old_Yong, Old_Middle, Old_Senior)
# colnames(temp) <- c("DL.System", "AUC", "PCAUC", "Subgroup")
# temp$AUC <- as.numeric.factor(temp$AUC)
# temp$PCAUC <- as.numeric.factor(temp$PCAUC)
# View(temp)
# ggplot(temp, aes(x=DL.System, y=AUC, fill=Subgroup))+  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
aucTable <- rbind(all, New, Old, Young, Middle, Senior, Referral, DOTS, WalkIn, Femal, Male)
aucTable <- rbind(all, New, Old, Young, Middle, Senior, Referral, DOTS, WalkIn, Female, Male)
source("DataWrangling/GlobalOption.R")
source("radiologist.R")
Radiologist <- Radiologist[Radiologist$Referral %in% "MDF", ]
New <- MDF[MDF$TB.Medication.History %in% "No",]
Old <- MDF[MDF$TB.Medication.History %in% "Yes",]
Female <- MDF[MDF$Gender %in% "F", ]
Male <- MDF[MDF$Gender %in% "M", ]
Young <- MDF[MDF$AgeGroup %in% "[15,25)",]
Middle <- MDF[MDF$AgeGroup %in% "[25,60)",]
Senior <- MDF[MDF$AgeGroup %in% "[60,108]",]
Referral <- subset(MDF, MDF$UseCase %in% "PrivatePublicReferral")
DOTS <- subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting")
WalkIn <- subset(MDF, MDF$UseCase %in% "WalkIn")
# Missing <- subset(MDF, is.na(MDF$UseCase)==T)
New_long <- MDF_long[MDF_long$TB.Medication.History %in% "No",]
Old_long <- MDF_long[MDF_long$TB.Medication.History %in% "Yes",]
Young_long <- MDF_long[MDF_long$AgeGroup %in% "[15,25)",]
Middle_long <- MDF_long[MDF_long$AgeGroup %in% "[25,60)",]
Senior_long <- MDF_long[MDF_long$AgeGroup %in% "[60,108]",]
Referral_long  <- subset(MDF_long, MDF_long$UseCase %in% "PrivatePublicReferral")
DOTS_long  <- subset(MDF_long, MDF_long$UseCase %in% "PublicDOTSRetesting")
WalkIn_long  <- subset(MDF_long, MDF_long$UseCase %in% "WalkIn")
#
#
# New_Yong <- MDF[MDF$TB.Medication.History %in% "No" & MDF$AgeGroup %in% "[15,25)",]
# Old_Yong <- MDF[MDF$TB.Medication.History %in% "Yes"& MDF$AgeGroup %in% "[15,25)",]
#
# New_Middle <- MDF[MDF$TB.Medication.History %in% "No" & MDF$AgeGroup %in% "[25,60)",]
# Old_Middle <- MDF[MDF$TB.Medication.History %in% "Yes"& MDF$AgeGroup %in% "[25,60)",]
#
# New_Senior <- MDF[MDF$TB.Medication.History %in% "No" & MDF$AgeGroup %in% "[60,108]",]
# Old_Senior <- MDF[MDF$TB.Medication.History %in% "Yes"& MDF$AgeGroup %in% "[60,108]",]
# Missing_long  <- subset(MDF, is.na(MDF$UseCase)==T)
# source("Chapter/Subgroup Table/Young.R")
# source("Chapter/Subgroup Table/Middle.R")
# source("Chapter/Subgroup Table/Senior.R")
# source("Chapter/Subgroup Table/Referral.R")
# source("Chapter/Subgroup Table/DOTS.R")
# write.csv(CAD_Xpert_plot_Middle, "Chapter/Subgroup Table/CAD_Xpert_plot_Middle.csv")
# write.csv(CAD_Xpert_plot_Young, "Chapter/Subgroup Table/CAD_Xpert_plot_Young.csv")
# write.csv(CAD_Xpert_plot_Senior, "Chapter/Subgroup Table/CAD_Xpert_plot_Senior.csv")
# write.csv(CAD_Xpert_plot_Referral, "Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
# write.csv(CAD_Xpert_plot_DOTS, "Chapter/Subgroup Table/CAD_Xpert_plot_DOTS.csv")
# write.csv(CAD_Xpert_plot_WalkIn, "Chapter/Subgroup Table/CAD_Xpert_plot_WalkIn.csv")
# write.csv(CAD_Xpert_plot_New, "Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
# write.csv(CAD_Xpert_plot_Old, "Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
# CAD_Xpert_plot_Middle <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Middle.csv")
# CAD_Xpert_plot_Young <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Young.csv")
# CAD_Xpert_plot_Senior <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Senior.csv")
# CAD_Xpert_plot_DOTS <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_DOTS.csv")
# CAD_Xpert_plot_WalkIn <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_WalkIn.csv")
# CAD_Xpert_plot_Referral <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
# CAD_Xpert_plot_New <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
# CAD_Xpert_plot_Old <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
#
#
# SubgroupTable <- rbind(CAD_Xpert_plot_New, CAD_Xpert_plot_Old, CAD_Xpert_plot_Young, CAD_Xpert_plot_Middle, CAD_Xpert_plot_Senior, CAD_Xpert_plot_Referral, CAD_Xpert_plot_DOTS, CAD_Xpert_plot_WalkIn)
# write.csv(SubgroupTable, "Chapter/Subgroup Table/SubgroupTable.csv", row.names = F)
# rm(list=(ls()))
## All
library(precrec)
library(ggplot2)
ROCPRC <- function(dataset){
attr <- attributes(evalmod(scores = dataset$CAD4TB6, labels = dataset$Xpert2Outcome_num))
aucT1 <- c("CAD4TB ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$qXRv2, labels = dataset$Xpert2Outcome_num))
aucT2 <- c("qXR ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$LunitScore, labels = dataset$Xpert2Outcome_num))
aucT3 <- c("Lunit INSIGHT CXR", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$JF1, labels = dataset$Xpert2Outcome_num))
aucT4 <- c("JF CXR-1", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$IF2, labels = dataset$Xpert2Outcome_num))
aucT5 <- c("InferReadDR ", round(attr$auc[4],3))
# return(mmcurves)
# return(autoplot(mmcurves))
aucT <- c(aucT1, aucT2, aucT3, aucT4, aucT5)
return(aucT)
}
l <- ROCPRC(MDF)
all <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
all$subgroup <- "all"
## New only
l <- ROCPRC(New)
New <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
New$subgroup <- "New cases"
## Old only
l <- ROCPRC(Old)
Old <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Old$subgroup <- "Previously treated cases"
## Young
l <- ROCPRC(Young)
Young <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Young$subgroup <- "Young age"
## Middle
l <- ROCPRC(Middle)
Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Middle$subgroup <- "Middle age"
## Senior
l <- ROCPRC(Senior)
Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Senior$subgroup <- "Old age"
## Referral only
l <- ROCPRC(Referral)
Referral <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Referral$subgroup <- "Referred"
## DOTS only
l <- ROCPRC(DOTS)
DOTS <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
DOTS$subgroup <- "DOTS retested"
## Walk-in only
l <- ROCPRC(WalkIn)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "WalkIn"
## Female
l <- ROCPRC(Female)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "Female"
## Male
l <- ROCPRC(Male)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "Male"
#### stratification by age AND prior TB history
# l <- ROCPRC(New_Yong)
# New_Yong <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Yong$subgroup <- "New_Yong"
#
#
# l <- ROCPRC(New_Middle)
# New_Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Middle$subgroup <- "New_Middle"
#
#
# l <- ROCPRC(New_Senior)
# New_Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Senior$subgroup <- "New_Senior"
#
#
#
# l <- ROCPRC(Old_Yong)
# Old_Yong <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Yong$subgroup <- "Old_Yong"
#
#
# l <- ROCPRC(Old_Middle)
# Old_Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Middle$subgroup <- "Old_Middle"
#
#
#
# l <- ROCPRC(Old_Senior)
# Old_Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Senior$subgroup <- "Old_Senior"
#
#
# temp <- rbind(New_Yong, New_Middle, New_Senior, Old_Yong, Old_Middle, Old_Senior)
# colnames(temp) <- c("DL.System", "AUC", "PCAUC", "Subgroup")
# temp$AUC <- as.numeric.factor(temp$AUC)
# temp$PCAUC <- as.numeric.factor(temp$PCAUC)
# View(temp)
# ggplot(temp, aes(x=DL.System, y=AUC, fill=Subgroup))+  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
aucTable <- rbind(all, New, Old, Young, Middle, Senior, Referral, DOTS, WalkIn, Female, Male)
source("DataWrangling/GlobalOption.R")
source("radiologist.R")
Radiologist <- Radiologist[Radiologist$Referral %in% "MDF", ]
New <- MDF[MDF$TB.Medication.History %in% "No",]
Old <- MDF[MDF$TB.Medication.History %in% "Yes",]
Female <- MDF[MDF$Gender %in% "F", ]
Male <- MDF[MDF$Gender %in% "M", ]
Young <- MDF[MDF$AgeGroup %in% "[15,25)",]
Middle <- MDF[MDF$AgeGroup %in% "[25,60)",]
Senior <- MDF[MDF$AgeGroup %in% "[60,108]",]
Referral <- subset(MDF, MDF$UseCase %in% "PrivatePublicReferral")
DOTS <- subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting")
WalkIn <- subset(MDF, MDF$UseCase %in% "WalkIn")
# Missing <- subset(MDF, is.na(MDF$UseCase)==T)
New_long <- MDF_long[MDF_long$TB.Medication.History %in% "No",]
Old_long <- MDF_long[MDF_long$TB.Medication.History %in% "Yes",]
Young_long <- MDF_long[MDF_long$AgeGroup %in% "[15,25)",]
Middle_long <- MDF_long[MDF_long$AgeGroup %in% "[25,60)",]
Senior_long <- MDF_long[MDF_long$AgeGroup %in% "[60,108]",]
Referral_long  <- subset(MDF_long, MDF_long$UseCase %in% "PrivatePublicReferral")
DOTS_long  <- subset(MDF_long, MDF_long$UseCase %in% "PublicDOTSRetesting")
WalkIn_long  <- subset(MDF_long, MDF_long$UseCase %in% "WalkIn")
#
#
# New_Yong <- MDF[MDF$TB.Medication.History %in% "No" & MDF$AgeGroup %in% "[15,25)",]
# Old_Yong <- MDF[MDF$TB.Medication.History %in% "Yes"& MDF$AgeGroup %in% "[15,25)",]
#
# New_Middle <- MDF[MDF$TB.Medication.History %in% "No" & MDF$AgeGroup %in% "[25,60)",]
# Old_Middle <- MDF[MDF$TB.Medication.History %in% "Yes"& MDF$AgeGroup %in% "[25,60)",]
#
# New_Senior <- MDF[MDF$TB.Medication.History %in% "No" & MDF$AgeGroup %in% "[60,108]",]
# Old_Senior <- MDF[MDF$TB.Medication.History %in% "Yes"& MDF$AgeGroup %in% "[60,108]",]
# Missing_long  <- subset(MDF, is.na(MDF$UseCase)==T)
# source("Chapter/Subgroup Table/Young.R")
# source("Chapter/Subgroup Table/Middle.R")
# source("Chapter/Subgroup Table/Senior.R")
# source("Chapter/Subgroup Table/Referral.R")
# source("Chapter/Subgroup Table/DOTS.R")
# write.csv(CAD_Xpert_plot_Middle, "Chapter/Subgroup Table/CAD_Xpert_plot_Middle.csv")
# write.csv(CAD_Xpert_plot_Young, "Chapter/Subgroup Table/CAD_Xpert_plot_Young.csv")
# write.csv(CAD_Xpert_plot_Senior, "Chapter/Subgroup Table/CAD_Xpert_plot_Senior.csv")
# write.csv(CAD_Xpert_plot_Referral, "Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
# write.csv(CAD_Xpert_plot_DOTS, "Chapter/Subgroup Table/CAD_Xpert_plot_DOTS.csv")
# write.csv(CAD_Xpert_plot_WalkIn, "Chapter/Subgroup Table/CAD_Xpert_plot_WalkIn.csv")
# write.csv(CAD_Xpert_plot_New, "Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
# write.csv(CAD_Xpert_plot_Old, "Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
# CAD_Xpert_plot_Middle <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Middle.csv")
# CAD_Xpert_plot_Young <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Young.csv")
# CAD_Xpert_plot_Senior <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Senior.csv")
# CAD_Xpert_plot_DOTS <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_DOTS.csv")
# CAD_Xpert_plot_WalkIn <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_WalkIn.csv")
# CAD_Xpert_plot_Referral <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
# CAD_Xpert_plot_New <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
# CAD_Xpert_plot_Old <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
#
#
# SubgroupTable <- rbind(CAD_Xpert_plot_New, CAD_Xpert_plot_Old, CAD_Xpert_plot_Young, CAD_Xpert_plot_Middle, CAD_Xpert_plot_Senior, CAD_Xpert_plot_Referral, CAD_Xpert_plot_DOTS, CAD_Xpert_plot_WalkIn)
# write.csv(SubgroupTable, "Chapter/Subgroup Table/SubgroupTable.csv", row.names = F)
# rm(list=(ls()))
## All
library(precrec)
library(ggplot2)
ROCPRC <- function(dataset){
attr <- attributes(evalmod(scores = dataset$CAD4TB6, labels = dataset$Xpert2Outcome_num))
aucT1 <- c("CAD4TB ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$qXRv2, labels = dataset$Xpert2Outcome_num))
aucT2 <- c("qXR ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$LunitScore, labels = dataset$Xpert2Outcome_num))
aucT3 <- c("Lunit INSIGHT CXR", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$JF1, labels = dataset$Xpert2Outcome_num))
aucT4 <- c("JF CXR-1", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$IF2, labels = dataset$Xpert2Outcome_num))
aucT5 <- c("InferReadDR ", round(attr$auc[4],3))
# return(mmcurves)
# return(autoplot(mmcurves))
aucT <- c(aucT1, aucT2, aucT3, aucT4, aucT5)
return(aucT)
}
l <- ROCPRC(MDF)
all <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
all$subgroup <- "all"
## New only
l <- ROCPRC(New)
New <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
New$subgroup <- "New cases"
## Old only
l <- ROCPRC(Old)
Old <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Old$subgroup <- "Previously treated cases"
## Young
l <- ROCPRC(Young)
Young <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Young$subgroup <- "Young age"
## Middle
l <- ROCPRC(Middle)
Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Middle$subgroup <- "Middle age"
## Senior
l <- ROCPRC(Senior)
Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Senior$subgroup <- "Old age"
## Referral only
l <- ROCPRC(Referral)
Referral <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Referral$subgroup <- "Referred"
## DOTS only
l <- ROCPRC(DOTS)
DOTS <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
DOTS$subgroup <- "DOTS retested"
## Walk-in only
l <- ROCPRC(WalkIn)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "WalkIn"
## Female
l <- ROCPRC(Female)
Female <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Female$subgroup <- "Female"
## Male
l <- ROCPRC(Male)
Male <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Male$subgroup <- "Male"
#### stratification by age AND prior TB history
# l <- ROCPRC(New_Yong)
# New_Yong <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Yong$subgroup <- "New_Yong"
#
#
# l <- ROCPRC(New_Middle)
# New_Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Middle$subgroup <- "New_Middle"
#
#
# l <- ROCPRC(New_Senior)
# New_Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# New_Senior$subgroup <- "New_Senior"
#
#
#
# l <- ROCPRC(Old_Yong)
# Old_Yong <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Yong$subgroup <- "Old_Yong"
#
#
# l <- ROCPRC(Old_Middle)
# Old_Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Middle$subgroup <- "Old_Middle"
#
#
#
# l <- ROCPRC(Old_Senior)
# Old_Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
# Old_Senior$subgroup <- "Old_Senior"
#
#
# temp <- rbind(New_Yong, New_Middle, New_Senior, Old_Yong, Old_Middle, Old_Senior)
# colnames(temp) <- c("DL.System", "AUC", "PCAUC", "Subgroup")
# temp$AUC <- as.numeric.factor(temp$AUC)
# temp$PCAUC <- as.numeric.factor(temp$PCAUC)
# View(temp)
# ggplot(temp, aes(x=DL.System, y=AUC, fill=Subgroup))+  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
aucTable <- rbind(all, New, Old, Young, Middle, Senior, Referral, DOTS, WalkIn, Female, Male)
colnames(aucTable) <- c("DL System", "AUC", "PCAUC", "Subgroup")
write.csv(aucTable, "Results/aucTable.csv")
# rm(list=(ls()))
aucTable <- read.csv("Results/aucTable.csv")
aucTable <- aucTable[, -1]
### AUC
age<-ggplot(aucTable[aucTable$Subgroup %in% c("Young age", "Middle age", "Old age"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) +  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
referral<-ggplot(aucTable[aucTable$Subgroup %in% c("Referred", "DOTS retested", "WalkIn"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.7, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
history<-ggplot(aucTable[aucTable$Subgroup %in% c("New cases", "Previously treated cases"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
gender <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
### PRC
agePC<-ggplot(aucTable[aucTable$Subgroup %in% c("Young age", "Middle age", "Old age"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) +  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
referralPC<-ggplot(aucTable[aucTable$Subgroup %in% c("Referred", "DOTS retested", "WalkIn"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.7, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
historyPC<-ggplot(aucTable[aucTable$Subgroup %in% c("New cases", "Previously treated cases"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
tiff("Results/AUC plot.tif", width = 18, height = 8, units = "in", res = 100)
require(gridExtra)
grid.arrange(age, referral, history, agePC, referralPC, historyPC, gender, genderPC, ncol=4)
# grid.arrange(age, referral, history, ncol=3)
dev.off()
rm(age, referral, history, agePC, referralPC, historyPC, gender, genderPC)
aucTable <- read.csv("Results/aucTable.csv")
aucTable <- aucTable[, -1]
### AUC
age<-ggplot(aucTable[aucTable$Subgroup %in% c("Young age", "Middle age", "Old age"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) +  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
referral<-ggplot(aucTable[aucTable$Subgroup %in% c("Referred", "DOTS retested", "WalkIn"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.7, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
history<-ggplot(aucTable[aucTable$Subgroup %in% c("New cases", "Previously treated cases"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
gender <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
### PRC
agePC<-ggplot(aucTable[aucTable$Subgroup %in% c("Young age", "Middle age", "Old age"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) +  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
referralPC<-ggplot(aucTable[aucTable$Subgroup %in% c("Referred", "DOTS retested", "WalkIn"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.7, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
historyPC<-ggplot(aucTable[aucTable$Subgroup %in% c("New cases", "Previously treated cases"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
tiff("Results/PRC ROC AUC plot.tif", width = 18, height = 8, units = "in", res = 100)
require(gridExtra)
grid.arrange(age, referral, history, gender, agePC, referralPC, historyPC, genderPC, ncol=4)
# grid.arrange(age, referral, history, ncol=3)
dev.off()
# rm(age, referral, history, agePC, referralPC, historyPC, gender, genderPC)
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05)) + scale_colour_brewer("Colors in Paired", palette="Paired")
genderPC
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05)) + scale_colour_brewer(palette="Paired")
genderPC
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05)) + scale_colour_brewer(palette = "Set1")
genderPC
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05)) + scale_colour_brewer(palette = "Greens")
genderPC
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup, color=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05)) + scale_colour_brewer(palette = "Greens")
genderPC
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, color=Subgroup, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05)) + scale_colour_brewer(palette = "Greens")
genderPC
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, color=Subgroup, fill=Subgroup)) + scale_colour_brewer(palette = "Greens") + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
genderPC
tiff("Results/PRC AUC plot.tif", width = 9, height = 8, units = "in", res = 100)
grid.arrange(agePC, referralPC, historyPC, genderPC, ncol=2)
dev.off()
aucTable <- read.csv("Results/aucTable.csv")
aucTable <- aucTable[, -1]
### AUC
age<-ggplot(aucTable[aucTable$Subgroup %in% c("Young age", "Middle age", "Old age"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) +  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
referral<-ggplot(aucTable[aucTable$Subgroup %in% c("Referred", "DOTS retested", "WalkIn"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.7, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
history<-ggplot(aucTable[aucTable$Subgroup %in% c("New cases", "Previously treated cases"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
gender <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=AUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
### PRC
agePC<-ggplot(aucTable[aucTable$Subgroup %in% c("Young age", "Middle age", "Old age"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) +  geom_bar(stat="identity", width=0.6, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
referralPC<-ggplot(aucTable[aucTable$Subgroup %in% c("Referred", "DOTS retested", "WalkIn"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.7, position=position_dodge())+theme_minimal()+ theme(legend.position = "top")+  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
historyPC<-ggplot(aucTable[aucTable$Subgroup %in% c("New cases", "Previously treated cases"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0.3, 0.8) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.8, 0.05), breaks = seq(0.3, 0.8, 0.05))
genderPC <- ggplot(aucTable[aucTable$Subgroup %in% c("Female", "Male"), ], aes(x=DL.System, y=PCAUC, fill=Subgroup)) + geom_bar(stat="identity", width=0.5, position=position_dodge())+theme_minimal() + theme(legend.position = "top") +  ylim(0, 0.95) + theme(panel.grid.minor = element_line(size=0.5)) + scale_y_continuous(minor_breaks = seq(0 , 0.95, 0.05), breaks = seq(0.65, 0.95, 0.05))
tiff("Results/PRC ROC AUC plot.tif", width = 18, height = 8, units = "in", res = 100)
require(gridExtra)
grid.arrange(age, referral, history, gender, agePC, referralPC, historyPC, genderPC, ncol=4)
# grid.arrange(age, referral, history, ncol=3)
dev.off()
# rm(age, referral, history, agePC, referralPC, historyPC, gender, genderPC)
tiff("Results/PRC AUC plot.tif", width = 9, height = 8, units = "in", res = 100)
grid.arrange(agePC, referralPC, historyPC, genderPC, ncol=2)
dev.off()
