# source("Chapter/Subgroup Table/Referral.R")
# source("Chapter/Subgroup Table/DOTS.R")
# write.csv(CAD_Xpert_plot_Middle, "Chapter/Subgroup Table/CAD_Xpert_plot_Middle.csv")
# write.csv(CAD_Xpert_plot_Young, "Chapter/Subgroup Table/CAD_Xpert_plot_Young.csv")
# write.csv(CAD_Xpert_plot_Senior, "Chapter/Subgroup Table/CAD_Xpert_plot_Senior.csv")
# write.csv(CAD_Xpert_plot_Referral, "Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
# write.csv(CAD_Xpert_plot_DOTS, "Chapter/Subgroup Table/CAD_Xpert_plot_DOTS.csv")
# write.csv(CAD_Xpert_plot_WalkIn, "Chapter/Subgroup Table/CAD_Xpert_plot_WalkIn.csv")
# write.csv(CAD_Xpert_plot_New, "Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
write.csv(CAD_Xpert_plot_Old, "Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
CAD_Xpert_plot_Middle <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Middle.csv")
CAD_Xpert_plot_Middle <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Middle.csv")
CAD_Xpert_plot_Young <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Young.csv")
CAD_Xpert_plot_Senior <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Senior.csv")
CAD_Xpert_plot_DOTS <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_DOTS.csv")
CAD_Xpert_plot_WalkIn <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_WalkIn.csv")
SubgroupTable <- rbind(CAD_Xpert_plot_New, CAD_Xpert_plot_Old, CAD_Xpert_plot_Young, CAD_Xpert_plot_Middle, CAD_Xpert_plot_Senior, CAD_Xpert_plot_Referral, CAD_Xpert_plot_DOTS, CAD_Xpert_plot_WalkIn)
CAD_Xpert_plot_Referral <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
CAD_Xpert_plot_Referral <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Referral.csv")
SubgroupTable <- rbind(CAD_Xpert_plot_New, CAD_Xpert_plot_Old, CAD_Xpert_plot_Young, CAD_Xpert_plot_Middle, CAD_Xpert_plot_Senior, CAD_Xpert_plot_Referral, CAD_Xpert_plot_DOTS, CAD_Xpert_plot_WalkIn)
CAD_Xpert_plot_New <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
CAD_Xpert_plot_New <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_New.csv")
CAD_Xpert_plot_Old <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
CAD_Xpert_plot_Old <- read.csv("Chapter/Subgroup Table/CAD_Xpert_plot_Old.csv")
SubgroupTable <- rbind(CAD_Xpert_plot_New, CAD_Xpert_plot_Old, CAD_Xpert_plot_Young, CAD_Xpert_plot_Middle, CAD_Xpert_plot_Senior, CAD_Xpert_plot_Referral, CAD_Xpert_plot_DOTS, CAD_Xpert_plot_WalkIn)
write.csv(SubgroupTable, "Chapter/Subgroup Table/SubgroupTable.csv", row.names = F)
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
rm(list=(ls()))
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
SubgroupPlot <- SubgroupPlot[, -1]
View(SubgroupPlot)
summary(SubgroupPlot$subgroup[)
summary(SubgroupPlot$subgroup)
summary(SubgroupPlot$Score)
SubgroupPlot$Score[SubgroupPlot$DeepLearningSystem %in% "CAD4TB"] <- SubgroupPlot$Score[SubgroupPlot$DeepLearningSystem %in% "CAD4TB"]/100
SubgroupPlot$subgroup <- as.character(SubgroupPlot$subgroup)
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "New"] <- "1.New Case"
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "Old"] <- "2.Previously Treated Case"
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "Young"] <- "3.Young age [15,25)"
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "Middle"] <- "4.Middle age [25,60)"
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "Senior"] <- "5.Old age [60,108]"
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "DOTS"] <- "7.Public DOTS Retesting"
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "Referral"] <-"6.Private Public Referral"
SubgroupPlot$subgroup[SubgroupPlot$subgroup %in% "WalkIn"] <-"8.Walk In"
SubgroupPlot$subgroup <- as.factor(SubgroupPlot$subgroup)
SubgroupPlotOrigin <- SubgroupPlot
########### Human vs AI ####################
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
SubgroupPlot <- SubgroupPlot[, -1]
CAD_Xpert_plot <- read.csv("Results/CAD_Xpert_Precise.csv")
CAD_Xpert_plot <- CAD_Xpert_plot[!CAD_Xpert_plot$DeepLearningSystem %in% c("IF1", "JF2", "IF3"), ]
CAD_Xpert_plot <- CAD_Xpert_plot[CAD_Xpert_plot$Site %in% "BGD", ]
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
source("radiologist.R")
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
AI <- CAD_Xpert_plot[CAD_Xpert_plot$Comment !="" , c(17, 14, 4, 24, 25, 18)]
View(AI)
AI$Subject <- paste(AI$DeepLearningSystem, AI$Comment)
require(data.table)
AI <- as.data.table(AI)
# # knitr::kable(AI[AI[, .I[which.max(Spec)], by=Subject]$V1])
AI <- AI[AI[, .I[which.max(Spec)], by=Subject]$V1]
View(AI)
AI[grep("Radiologists' ", AI$Comment), ]
AI <- AI[grep("Radiologists' ", AI$Comment), ]
View(AI)
humanAI <- cbind(Human, AI[, c(1,2,4, 5, 3)])
humanAI$Diff <- percent(humanAI[, 9]- humanAI[, 4])
humanAI <- humanAI[, c(1,2,3,5:8, 10, 9,4)]
colnames(humanAI) <- c("Human Benchmark", "Sensitivity", "Specificy", "DL Product", "Score", "DL Sensitivity", "DL Specificity", "Difference", "specAI", "specH")
View(humanAI)
### McNemar test specificity
healthy <- sum(MDF$Xpert2Outcome_num %in% "0")
humanAI$CI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$specAI[i]*healthy, healthy*humanAI$specH[i]), n=c(healthy, healthy))
humanAI$CI[i] <- paste0(percent(test$conf.int[1]), " - ", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$CI
View(humanAI)
humanAI$CI[i] <- paste0(percent(test$conf.int[1], suffix = ""), " - ", percent(test$conf.int[2]))
# library(readr)
# humanAI <- read_csv("Results/humanAI.csv",
#                     col_types = cols(`Diff.specificity` = col_number()))
humanAI$CI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$specAI[i]*healthy, healthy*humanAI$specH[i]), n=c(healthy, healthy))
humanAI$CI[i] <- paste0(percent(test$conf.int[1], suffix = ""), " - ", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$CI
View(Human)
View(humanAI)
write.csv(humanAI, "Results/humanAI.csv", row.names = F)
rm(AI, Human)
View(humanAI)
source("DataWrangling/GlobalOption.R")
HumanReader <- function (dataset){
### Highly suggestive of TB -------------------------------
TP <- sum(dataset$rad.highly.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.highly.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(dataset$rad.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(dataset$rad.abn %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.abn %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
AccuracyTable <- data.frame(matrix(unlist(c(Highly, Probably, Any)), nrow = 3, byrow = T))
colnames(AccuracyTable) <- c("Sens", "Sens_L", "Sens_H", "Spec", "Spec_L", "Spec_H")
AccuracyTable$X <- 1-AccuracyTable$Spec
AccuracyTable$AccuracyTableCategory <- c("Highly Suggestive", "Probably TB", "Any Abnormality")
AccuracyTable$Referral <- deparse(substitute(dataset))
rm(Highly, Probably, Any, rval)
return(AccuracyTable)
}
allReferral <- HumanReader(MDF)
Referral <- HumanReader(subset(MDF, MDF$UseCase %in% "PrivatePublicReferral"))
DOTS <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting"))
WalkIn <- HumanReader(subset(MDF, MDF$UseCase %in% "WalkIn"))
Missing <- HumanReader(subset(MDF, is.na(MDF$UseCase)==T))
Radiologist <- rbind(allReferral, Referral, DOTS, WalkIn, Missing)
rm(allReferral, Referral, DOTS, WalkIn, Missing)
Radiologist$Sensitivity <- paste0(percent(Radiologist$Sens), ", (", percent(Radiologist$Sens_L, suffix = ""), " - ", percent(Radiologist$Sens_H), ")")
Radiologist$Specificity <- paste0(percent(Radiologist$Spec), ", (", percent(Radiologist$Spec_L, suffix = ""), " - ", percent(Radiologist$Spec_H), ")")
source("DataWrangling/GlobalOption.R")
source("radiologist.R")
########### Human vs AI ####################
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
SubgroupPlot <- SubgroupPlot[, -1]
CAD_Xpert_plot <- read.csv("Results/CAD_Xpert_Precise.csv")
CAD_Xpert_plot <- CAD_Xpert_plot[!CAD_Xpert_plot$DeepLearningSystem %in% c("IF1", "JF2", "IF3"), ]
CAD_Xpert_plot <- CAD_Xpert_plot[CAD_Xpert_plot$Site %in% "BGD", ]
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
AI <- CAD_Xpert_plot[CAD_Xpert_plot$Comment !="" , c(17, 14, 4, 24, 25, 18)]
AI$Subject <- paste(AI$DeepLearningSystem, AI$Comment)
require(data.table)
AI <- as.data.table(AI)
# # knitr::kable(AI[AI[, .I[which.max(Spec)], by=Subject]$V1])
AI <- AI[AI[, .I[which.max(Spec)], by=Subject]$V1]
AI <- AI[grep("Radiologists' ", AI$Comment), ]
humanAI <- cbind(Human, AI[, c(1,2,4, 5, 3)])
humanAI$Diff <- percent(humanAI[, 9]- humanAI[, 4])
humanAI <- humanAI[, c(1,2,3,5:8, 10, 9,4)]
colnames(humanAI) <- c("Human Benchmark", "Sensitivity", "Specificy", "DL Product", "Score", "DL Sensitivity", "DL Specificity", "Difference", "specAI", "specH")
### McNemar test specificity
healthy <- sum(MDF$Xpert2Outcome_num %in% "0")
# library(readr)
# humanAI <- read_csv("Results/humanAI.csv",
#                     col_types = cols(`Diff.specificity` = col_number()))
humanAI$CI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$specAI[i]*healthy, healthy*humanAI$specH[i]), n=c(healthy, healthy))
humanAI$CI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$CI
write.csv(humanAI, "Results/humanAI.csv", row.names = F)
rm(AI, Human)
View(humanAI)
View(humanAI)
View(humanAI)
View(Radiologist)
source("DataWrangling/GlobalOption.R")
HumanReader <- function (dataset){
### Highly suggestive of TB -------------------------------
TP <- sum(dataset$rad.highly.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.highly.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(dataset$rad.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(dataset$rad.abn %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.abn %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
AccuracyTable <- data.frame(matrix(unlist(c(Highly, Probably, Any)), nrow = 3, byrow = T))
colnames(AccuracyTable) <- c("Sens", "Sens_L", "Sens_H", "Spec", "Spec_L", "Spec_H")
AccuracyTable$X <- 1-AccuracyTable$Spec
AccuracyTable$AccuracyTableCategory <- c("Highly Suggestive", "Probably TB", "Any Abnormality")
AccuracyTable$Referral <- deparse(substitute(dataset))
rm(Highly, Probably, Any, rval)
return(AccuracyTable)
}
allReferral <- HumanReader(MDF)
Referral <- HumanReader(subset(MDF, MDF$UseCase %in% "PrivatePublicReferral"))
DOTS <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting"))
WalkIn <- HumanReader(subset(MDF, MDF$UseCase %in% "WalkIn"))
Missing <- HumanReader(subset(MDF, is.na(MDF$UseCase)==T))
Radiologist <- rbind(allReferral, Referral, DOTS, WalkIn, Missing)
rm(allReferral, Referral, DOTS, WalkIn, Missing)
Radiologist$Sensitivity <- paste0(percent(Radiologist$Sens), ", (", percent(Radiologist$Sens_L, suffix = ""), "-", percent(Radiologist$Sens_H), ")")
Radiologist$Specificity <- paste0(percent(Radiologist$Spec), ", (", percent(Radiologist$Spec_L, suffix = ""), "-", percent(Radiologist$Spec_H), ")")
View(Radiologist)
Radiologist$Sensitivity <- paste0(percent(Radiologist$Sens), ", (", percent(Radiologist$Sens_L, suffix = ""), "-", percent(Radiologist$Sens_H), ")")
Radiologist$Specificity <- paste0(percent(Radiologist$Spec), ", (", percent(Radiologist$Spec_L, suffix = ""), "-", percent(Radiologist$Spec_H), ")")
Radiologist$Specificity
source("DataWrangling/GlobalOption.R")
HumanReader <- function (dataset){
### Highly suggestive of TB -------------------------------
TP <- sum(dataset$rad.highly.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.highly.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(dataset$rad.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(dataset$rad.abn %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.abn %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
AccuracyTable <- data.frame(matrix(unlist(c(Highly, Probably, Any)), nrow = 3, byrow = T))
colnames(AccuracyTable) <- c("Sens", "Sens_L", "Sens_H", "Spec", "Spec_L", "Spec_H")
AccuracyTable$X <- 1-AccuracyTable$Spec
AccuracyTable$AccuracyTableCategory <- c("Highly Suggestive", "Probably TB", "Any Abnormality")
AccuracyTable$Referral <- deparse(substitute(dataset))
rm(Highly, Probably, Any, rval)
return(AccuracyTable)
}
allReferral <- HumanReader(MDF)
Referral <- HumanReader(subset(MDF, MDF$UseCase %in% "PrivatePublicReferral"))
DOTS <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting"))
WalkIn <- HumanReader(subset(MDF, MDF$UseCase %in% "WalkIn"))
Missing <- HumanReader(subset(MDF, is.na(MDF$UseCase)==T))
Radiologist <- rbind(allReferral, Referral, DOTS, WalkIn, Missing)
rm(allReferral, Referral, DOTS, WalkIn, Missing)
Radiologist$Sensitivity <- paste0(percent(Radiologist$Sens), ", (", percent(Radiologist$Sens_L, suffix = ""), "-", percent(Radiologist$Sens_H), ")")
Radiologist$Specificity <- paste0(percent(Radiologist$Spec), ", (", percent(Radiologist$Spec_L, suffix = ""), "-", percent(Radiologist$Spec_H), ")")
View(Radiologist)
source("DataWrangling/GlobalOption.R")
source("radiologist.R")
########### Human vs AI ####################
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
SubgroupPlot <- SubgroupPlot[, -1]
CAD_Xpert_plot <- read.csv("Results/CAD_Xpert_Precise.csv")
CAD_Xpert_plot <- CAD_Xpert_plot[!CAD_Xpert_plot$DeepLearningSystem %in% c("IF1", "JF2", "IF3"), ]
CAD_Xpert_plot <- CAD_Xpert_plot[CAD_Xpert_plot$Site %in% "BGD", ]
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
AI <- CAD_Xpert_plot[CAD_Xpert_plot$Comment !="" , c(17, 14, 4, 24, 25, 18)]
AI$Subject <- paste(AI$DeepLearningSystem, AI$Comment)
require(data.table)
AI <- as.data.table(AI)
# # knitr::kable(AI[AI[, .I[which.max(Spec)], by=Subject]$V1])
AI <- AI[AI[, .I[which.max(Spec)], by=Subject]$V1]
AI <- AI[grep("Radiologists' ", AI$Comment), ]
humanAI <- cbind(Human, AI[, c(1,2,4, 5, 3)])
humanAI$Diff <- percent(humanAI[, 9]- humanAI[, 4])
humanAI <- humanAI[, c(1,2,3,5:8, 10, 9,4)]
colnames(humanAI) <- c("Human Benchmark", "Sensitivity", "Specificy", "DL Product", "Score", "DL Sensitivity", "DL Specificity", "Difference", "specAI", "specH")
### McNemar test specificity
healthy <- sum(MDF$Xpert2Outcome_num %in% "0")
# library(readr)
# humanAI <- read_csv("Results/humanAI.csv",
#                     col_types = cols(`Diff.specificity` = col_number()))
humanAI$CI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$specAI[i]*healthy, healthy*humanAI$specH[i]), n=c(healthy, healthy))
humanAI$CI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$CI
write.csv(humanAI, "Results/humanAI.csv", row.names = F)
rm(AI, Human)
View(CAD_Xpert_plot)
View(humanAI)
names(humanAI)
write.csv(humanAI[, -c(9, 10)], "Results/humanAI.csv", row.names = F)
View(humanAI)
write.csv(humanAI[, -c(9, 10)], "Results/humanAI.csv", row.names = F)
View(humanAI)
source("radiologist.R")
########### Human vs AI ####################
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
SubgroupPlot <- SubgroupPlot[, -1]
CAD_Xpert_plot <- read.csv("Results/CAD_Xpert_Precise.csv")
CAD_Xpert_plot <- CAD_Xpert_plot[!CAD_Xpert_plot$DeepLearningSystem %in% c("IF1", "JF2", "IF3"), ]
CAD_Xpert_plot <- CAD_Xpert_plot[CAD_Xpert_plot$Site %in% "BGD", ]
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
AI <- CAD_Xpert_plot[CAD_Xpert_plot$Comment !="" , c(17, 14, 4, 24, 25, 18)]
AI$Subject <- paste(AI$DeepLearningSystem, AI$Comment)
require(data.table)
AI <- as.data.table(AI)
# # knitr::kable(AI[AI[, .I[which.max(Spec)], by=Subject]$V1])
AI <- AI[AI[, .I[which.max(Spec)], by=Subject]$V1]
AI <- AI[grep("Radiologists' ", AI$Comment), ]
humanAI <- cbind(Human, AI[, c(1,2,4, 5, 3)])
humanAI$Diff <- percent(humanAI[, 9]- humanAI[, 4])
humanAI <- humanAI[, c(1,2,3,5:8, 10, 9,4)]
colnames(humanAI) <- c("Human Benchmark", "Sensitivity", "Specificy", "DL Product", "Score", "DL Sensitivity", "DL Specificity", "Difference", "specAI", "specH")
### McNemar test specificity
healthy <- sum(MDF$Xpert2Outcome_num %in% "0")
# library(readr)
# humanAI <- read_csv("Results/humanAI.csv",
#                     col_types = cols(`Diff.specificity` = col_number()))
humanAI$CI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$specAI[i]*healthy, healthy*humanAI$specH[i]), n=c(healthy, healthy))
humanAI$CI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$CI
write.csv(humanAI[, -c(9, 10)], "Results/humanAI.csv", row.names = F)
rm(AI, Human)
knitr::kable(humanAI, row.names = F)
humanAI <- read.csv("Results/HumanAI.csv", )
humanAI <- humanAI[c(3,6,9,12,15, 2,5,8,11,14, 1,4,7,10,13), -c(6, 9, 10)]
knitr::kable(humanAI, row.names = F)
humanAI <- read.csv("Results/HumanAI.csv", )
names(humanAI)
humanAI <- humanAI[c(3,6,9,12,15, 2,5,8,11,14, 1,4,7,10,13), -c(6)]
knitr::kable(humanAI, row.names = F)
humanAI$SpecificyIncrease <- paste0(humanAI$Specificy, "(", humanAI$CI, ")")
knitr::kable(humanAI, row.names = F)
humanAI <- read.csv("Results/HumanAI.csv", )
humanAI$SpecificyIncrease <- paste0(humanAI$Specificy, "(", humanAI$CI, ")")
names(humanAI)
humanAI <- humanAI[c(3,6,9,12,15, 2,5,8,11,14, 1,4,7,10,13), -c(6, 8,9)]
knitr::kable(humanAI, row.names = F)
humanAI <- read.csv("Results/HumanAI.csv", )
humanAI$SpecificyIncrease <- paste0(humanAI$Difference, "(", humanAI$CI, ")")
humanAI$SpecificyIncrease
humanAI$SpecificyIncrease <- paste0(humanAI$Difference, " (", humanAI$CI, ")")
humanAI$SpecificyIncrease
knitr::kable(humanAI, row.names = F)
humanAI <- humanAI[c(3,6,9,12,15, 2,5,8,11,14, 1,4,7,10,13), -c(6, 8,9)]
knitr::kable(humanAI, row.names = F)
View(humanAI)
humanAI
humanAI
humanAI[2:5, 1:3] <- ""
knitr::kable(humanAI, row.names = F)
humanAI[2:5, 1:3] <- " "
knitr::kable(humanAI, row.names = F)
humanAI[2:5, 1:3]
rm(humanAI[2:5, 1:3])
source("radiologist.R")
########### Human vs AI ####################
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
SubgroupPlot <- SubgroupPlot[, -1]
CAD_Xpert_plot <- read.csv("Results/CAD_Xpert_Precise.csv")
CAD_Xpert_plot <- CAD_Xpert_plot[!CAD_Xpert_plot$DeepLearningSystem %in% c("IF1", "JF2", "IF3"), ]
CAD_Xpert_plot <- CAD_Xpert_plot[CAD_Xpert_plot$Site %in% "BGD", ]
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
AI <- CAD_Xpert_plot[CAD_Xpert_plot$Comment !="" , c(17, 14, 4, 24, 25, 18)]
AI$Subject <- paste(AI$DeepLearningSystem, AI$Comment)
require(data.table)
AI <- as.data.table(AI)
# # knitr::kable(AI[AI[, .I[which.max(Spec)], by=Subject]$V1])
AI <- AI[AI[, .I[which.max(Spec)], by=Subject]$V1]
AI <- AI[grep("Radiologists' ", AI$Comment), ]
humanAI <- cbind(Human, AI[, c(1,2,4, 5, 3)])
humanAI$Diff <- percent(humanAI[, 9]- humanAI[, 4])
humanAI <- humanAI[, c(1,2,3,5:8, 10, 9,4)]
colnames(humanAI) <- c("Human Benchmark", "Sensitivity", "Specificy", "DL Product", "Score", "DL Sensitivity", "DL Specificity", "Difference", "specAI", "specH")
### McNemar test specificity
healthy <- sum(MDF$Xpert2Outcome_num %in% "0")
# library(readr)
# humanAI <- read_csv("Results/humanAI.csv",
#                     col_types = cols(`Diff.specificity` = col_number()))
humanAI$CI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$specAI[i]*healthy, healthy*humanAI$specH[i]), n=c(healthy, healthy))
humanAI$CI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$CI
humanAI$SpecificyIncrease <- paste0(humanAI$Difference, " (", humanAI$CI, ")")
humanAI <- humanAI[c(3,6,9,12,15, 2,5,8,11,14, 1,4,7,10,13), -c(6, 8,9)]
View(humanAI)
source("radiologist.R")
########### Human vs AI ####################
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
SubgroupPlot <- SubgroupPlot[, -1]
CAD_Xpert_plot <- read.csv("Results/CAD_Xpert_Precise.csv")
CAD_Xpert_plot <- CAD_Xpert_plot[!CAD_Xpert_plot$DeepLearningSystem %in% c("IF1", "JF2", "IF3"), ]
CAD_Xpert_plot <- CAD_Xpert_plot[CAD_Xpert_plot$Site %in% "BGD", ]
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
AI <- CAD_Xpert_plot[CAD_Xpert_plot$Comment !="" , c(17, 14, 4, 24, 25, 18)]
AI$Subject <- paste(AI$DeepLearningSystem, AI$Comment)
require(data.table)
AI <- as.data.table(AI)
# # knitr::kable(AI[AI[, .I[which.max(Spec)], by=Subject]$V1])
AI <- AI[AI[, .I[which.max(Spec)], by=Subject]$V1]
AI <- AI[grep("Radiologists' ", AI$Comment), ]
humanAI <- cbind(Human, AI[, c(1,2,4, 5, 3)])
humanAI$Diff <- percent(humanAI[, 9]- humanAI[, 4])
humanAI <- humanAI[, c(1,2,3,5:8, 10, 9,4)]
colnames(humanAI) <- c("Human Benchmark", "Sensitivity", "Specificy", "DL Product", "Score", "DL Sensitivity", "DL Specificity", "Difference", "specAI", "specH")
### McNemar test specificity
healthy <- sum(MDF$Xpert2Outcome_num %in% "0")
# library(readr)
# humanAI <- read_csv("Results/humanAI.csv",
#                     col_types = cols(`Diff.specificity` = col_number()))
humanAI$CI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$specAI[i]*healthy, healthy*humanAI$specH[i]), n=c(healthy, healthy))
humanAI$CI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
names(humanAI)
humanAI$SpecificyIncrease <- paste0(humanAI$Difference, " (", humanAI$CI, ")")
names(humanAI)
names(humanAI)
humanAI <- humanAI[c(3,6,9,12,15, 2,5,8,11,14, 1,4,7,10,13), -c(6, 8:11)]
humanAI[2:5, 1:3] <- " "
View(humanAI)
humanAI
1+5
6+5
humanAI[7:10, 1:3] <- " "
humanAI[12:15, 1:3] <- " "
View(humanAI)
write.csv(humanAI, "Results/humanAI.csv", row.names = F)
rm(AI, Human)
humanAI <- read.csv("Results/HumanAI.csv", )
knitr::kable(humanAI, row.names = F)
