Senior_long <- MDF_long[MDF_long$AgeGroup %in% "[60,108]",]
Referral_long  <- subset(MDF_long, MDF_long$UseCase %in% "PrivatePublicReferral")
DOTS_long  <- subset(MDF_long, MDF_long$UseCase %in% "PublicDOTSRetesting")
WalkIn_long  <- subset(MDF_long, MDF_long$UseCase %in% "WalkIn")
library(precrec)
library(ggplot2)
ROCPRC <- function(dataset){
attr <- attributes(evalmod(scores = dataset$CAD4TB6, labels = dataset$Xpert2Outcome_num))
aucT1 <- c("CAD4TB ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$qXRv3, labels = dataset$Xpert2Outcome_num))
aucT2 <- c("qXR ", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$LunitScore, labels = dataset$Xpert2Outcome_num))
aucT3 <- c("Lunit INSIGHT CXR", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$JF1, labels = dataset$Xpert2Outcome_num))
aucT4 <- c("JF CXR-1", round(attr$auc[4],3))
attr <- attributes(evalmod(scores = dataset$IF2, labels = dataset$Xpert2Outcome_num))
aucT5 <- c("InferReadDR ", round(attr$auc[4],3))
# return(mmcurves)
# return(autoplot(mmcurves))
aucT <- c(aucT1, aucT2, aucT3, aucT4, aucT5)
return(aucT)
}
l <- ROCPRC(MDF)
all <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
all$subgroup <- "all"
## New only
l <- ROCPRC(New)
New <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
New$subgroup <- "New cases"
## Old only
l <- ROCPRC(Old)
Old <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Old$subgroup <- "Previously treated cases"
## Young
l <- ROCPRC(Young)
Young <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Young$subgroup <- "Young age"
## Middle
l <- ROCPRC(Middle)
Middle <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Middle$subgroup <- "Middle age"
## Senior
l <- ROCPRC(Senior)
Senior <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Senior$subgroup <- "Old age"
## Referral only
l <- ROCPRC(Referral)
Referral <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Referral$subgroup <- "Referred"
## DOTS only
l <- ROCPRC(DOTS)
DOTS <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
DOTS$subgroup <- "DOTS retested"
## Walk-in only
l <- ROCPRC(WalkIn)
WalkIn <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
WalkIn$subgroup <- "WalkIn"
## Female
l <- ROCPRC(Female)
Female <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Female$subgroup <- "Female"
## Male
l <- ROCPRC(Male)
Male <- data.frame(matrix(unlist(l), nrow=5, byrow=T))
Male$subgroup <- "Male"
#### stratification by age AND prior TB history
aucTable <- rbind(all, New, Old, Young, Middle, Senior, Referral, DOTS, WalkIn, Female, Male)
colnames(aucTable) <- c("AI.Algorithm", "AUC", "PCAUC", "Subgroup")
aucTable
View(aucTable)
# subgroup 4 curves
SubgroupPlot <- read.csv("Chapter/Subgroup Table/SubgroupTable.csv")
source("DataWrangling/GlobalOption.R")
HumanReader <- function (dataset){
### Highly suggestive of TB -------------------------------
TP <- sum(dataset$rad.highly.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.highly.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(dataset$rad.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(dataset$rad.abn %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.abn %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
AccuracyTable <- data.frame(matrix(unlist(c(Highly, Probably, Any)), nrow = 3, byrow = T))
colnames(AccuracyTable) <- c("Sens", "Sens_L", "Sens_H", "Spec", "Spec_L", "Spec_H")
AccuracyTable$X <- 1-AccuracyTable$Spec
AccuracyTable$AccuracyTableCategory <- c("Highly Suggestive", "Probably TB", "Any Abnormality")
AccuracyTable$Referral <- deparse(substitute(dataset))
rm(Highly, Probably, Any, rval)
return(AccuracyTable)
}
summary(MDF$UseCase)
allReferral <- HumanReader(MDF)
PrivateReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PrivateReferral"))
PublicReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicReferral"))
DOTS <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting"))
WalkIn <- HumanReader(subset(MDF, MDF$UseCase %in% "WalkIn"))
Community <- HumanReader(subset(MDF, MDF$UseCase %in% "Community screening"))
Contacts <- HumanReader(subset(MDF, MDF$UseCase %in% "Contacts"))
Missing <- HumanReader(subset(MDF, is.na(MDF$UseCase)==T))
Radiologist <- rbind(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
rm(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
View(Radiologist)
TP <- sum(MDF$rad.highly.TB %in% "1" & MDF$Xpert2Outcome_num==1)
FP <- sum(MDF$rad.highly.TB %in% 1 & MDF$Xpert2Outcome_num==0)
TN <- sum(MDF$rad.highly.TB %in% 0 & MDF$Xpert2Outcome_num==0)
FN <- sum(MDF$rad.highly.TB %in% 0 & MDF$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(MDF$rad.TB %in% "1" & MDF$Xpert2Outcome_num==1)
FP <- sum(MDF$rad.TB %in% 1 & MDF$Xpert2Outcome_num==0)
TN <- sum(MDF$rad.TB %in% 0 & MDF$Xpert2Outcome_num==0)
FN <- sum(MDF$rad.TB %in% 0 & MDF$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(MDF$rad.abn %in% "1" & MDF$Xpert2Outcome_num==1)
FP <- sum(MDF$rad.abn %in% 1 & MDF$Xpert2Outcome_num==0)
TN <- sum(MDF$rad.abn %in% 0 & MDF$Xpert2Outcome_num==0)
FN <- sum(MDF$rad.abn %in% 0 & MDF$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55)]
rm(TP, FP, TN, FN)
Any$elements[c(59, 55)]
TP <- sum(MDF$rad.abn %in% "1" & MDF$Xpert2Outcome_num==1)
FP <- sum(MDF$rad.abn %in% 1 & MDF$Xpert2Outcome_num==0)
TN <- sum(MDF$rad.abn %in% 0 & MDF$Xpert2Outcome_num==0)
FN <- sum(MDF$rad.abn %in% 0 & MDF$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
rval$elements[c(59, 55)]
rval$elements[c(55:59)]
rval$elements[c(60:64)]
rval$elements[c(40:55)]
rval$elements[c(47,51)]
HumanReader <- function (dataset){
### Highly suggestive of TB -------------------------------
TP <- sum(dataset$rad.highly.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.highly.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(dataset$rad.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(dataset$rad.abn %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.abn %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
AccuracyTable <- data.frame(matrix(unlist(c(Highly, Probably, Any)), nrow = 3, byrow = T))
colnames(AccuracyTable) <- c("Sens", "Sens_L", "Sens_H", "Spec", "Spec_L", "Spec_H", "PPV", "PPV_L", "PPV_H", "NPV_L", "NPV_H")
AccuracyTable$X <- 1-AccuracyTable$Spec
AccuracyTable$AccuracyTableCategory <- c("Highly Suggestive", "Probably TB", "Any Abnormality")
AccuracyTable$Referral <- deparse(substitute(dataset))
rm(Highly, Probably, Any, rval)
return(AccuracyTable)
}
allReferral <- HumanReader(MDF)
PrivateReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PrivateReferral"))
PublicReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicReferral"))
DOTS <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting"))
WalkIn <- HumanReader(subset(MDF, MDF$UseCase %in% "WalkIn"))
Community <- HumanReader(subset(MDF, MDF$UseCase %in% "Community screening"))
Contacts <- HumanReader(subset(MDF, MDF$UseCase %in% "Contacts"))
Missing <- HumanReader(subset(MDF, is.na(MDF$UseCase)==T))
Radiologist <- rbind(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
rm(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
Radiologist$Sensitivity <- paste0(percent(Radiologist$Sens), ", (", percent(Radiologist$Sens_L, suffix = ""), "-", percent(Radiologist$Sens_H), ")")
Radiologist$Specificity <- paste0(percent(Radiologist$Spec), ", (", percent(Radiologist$Spec_L, suffix = ""), "-", percent(Radiologist$Spec_H), ")")
### PPV ---------
TP <- sum(MDF$rad.highly.TB %in% "1" & MDF$Xpert2Outcome_num==1)
View(Radiologist)
HumanReader <- function (dataset){
### Highly suggestive of TB -------------------------------
TP <- sum(dataset$rad.highly.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.highly.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(dataset$rad.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(dataset$rad.abn %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.abn %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
AccuracyTable <- data.frame(matrix(unlist(c(Highly, Probably, Any)), nrow = 3, byrow = T))
colnames(AccuracyTable) <- c("Sens", "Sens_L", "Sens_H", "Spec", "Spec_L", "Spec_H", "PPV", "PPV_L", "PPV_H", "NPV","NPV_L", "NPV_H")
AccuracyTable$X <- 1-AccuracyTable$Spec
AccuracyTable$AccuracyTableCategory <- c("Highly Suggestive", "Probably TB", "Any Abnormality")
AccuracyTable$Referral <- deparse(substitute(dataset))
rm(Highly, Probably, Any, rval)
return(AccuracyTable)
}
allReferral <- HumanReader(MDF)
PrivateReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PrivateReferral"))
PublicReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicReferral"))
DOTS <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting"))
WalkIn <- HumanReader(subset(MDF, MDF$UseCase %in% "WalkIn"))
Community <- HumanReader(subset(MDF, MDF$UseCase %in% "Community screening"))
Contacts <- HumanReader(subset(MDF, MDF$UseCase %in% "Contacts"))
Missing <- HumanReader(subset(MDF, is.na(MDF$UseCase)==T))
Radiologist <- rbind(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
rm(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
Radiologist$Sensitivity <- paste0(percent(Radiologist$Sens), ", (", percent(Radiologist$Sens_L, suffix = ""), "-", percent(Radiologist$Sens_H), ")")
Radiologist$Specificity <- paste0(percent(Radiologist$Spec), ", (", percent(Radiologist$Spec_L, suffix = ""), "-", percent(Radiologist$Spec_H), ")")
View(Radiologist)
### Any abnormalities ------------------------------
TP <- sum(MDF$rad.abn %in% "1" & MDF$Xpert2Outcome_num==1)
FP <- sum(MDF$rad.abn %in% 1 & MDF$Xpert2Outcome_num==0)
TN <- sum(MDF$rad.abn %in% 0 & MDF$Xpert2Outcome_num==0)
FN <- sum(MDF$rad.abn %in% 0 & MDF$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
rval$elements[c(59, 55, 51, 47)]
Any <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
write.csv(Radiologist, "Results/Radiologist.csv", row.names = FALSE)
HumanReader <- function (dataset){
### Highly suggestive of TB -------------------------------
TP <- sum(dataset$rad.highly.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.highly.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.highly.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Highly <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
###  High+possible ----------------------------
TP <- sum(dataset$rad.TB %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.TB %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.TB %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Probably <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
### Any abnormalities ------------------------------
TP <- sum(dataset$rad.abn %in% "1" & dataset$Xpert2Outcome_num==1)
FP <- sum(dataset$rad.abn %in% 1 & dataset$Xpert2Outcome_num==0)
TN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==0)
FN <- sum(dataset$rad.abn %in% 0 & dataset$Xpert2Outcome_num==1)
dat <- as.table(matrix(c(TP, FP, FN, TN), nrow=2, byrow=TRUE))
colnames(dat) <- c("Xpert+","Xpert-")
rownames(dat) <- c("CXR+","CXR-")
rval <- epi.tests(dat, conf.level = 0.95)
rval
Any <- rval$elements[c(59, 55, 51, 47)]
rm(TP, FP, TN, FN)
AccuracyTable <- data.frame(matrix(unlist(c(Highly, Probably, Any)), nrow = 3, byrow = T))
colnames(AccuracyTable) <- c("Sens", "Sens_L", "Sens_H", "Spec", "Spec_L", "Spec_H", "ppv", "ppv_L", "ppv_H", "npv","npv_L", "npv_H")
AccuracyTable$X <- 1-AccuracyTable$Spec
AccuracyTable$AccuracyTableCategory <- c("Highly Suggestive", "Probably TB", "Any Abnormality")
AccuracyTable$Referral <- deparse(substitute(dataset))
rm(Highly, Probably, Any, rval)
return(AccuracyTable)
}
allReferral <- HumanReader(MDF)
PrivateReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PrivateReferral"))
PublicReferral <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicReferral"))
DOTS <- HumanReader(subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting"))
WalkIn <- HumanReader(subset(MDF, MDF$UseCase %in% "WalkIn"))
Community <- HumanReader(subset(MDF, MDF$UseCase %in% "Community screening"))
Contacts <- HumanReader(subset(MDF, MDF$UseCase %in% "Contacts"))
Missing <- HumanReader(subset(MDF, is.na(MDF$UseCase)==T))
Radiologist <- rbind(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
rm(allReferral, PrivateReferral,PublicReferral, DOTS, WalkIn, Community,Contacts, Missing)
Radiologist$Sensitivity <- paste0(percent(Radiologist$Sens), ", (", percent(Radiologist$Sens_L, suffix = ""), "-", percent(Radiologist$Sens_H), ")")
Radiologist$Specificity <- paste0(percent(Radiologist$Spec), ", (", percent(Radiologist$Spec_L, suffix = ""), "-", percent(Radiologist$Spec_H), ")")
Radiologist$PPV <- paste0(percent(Radiologist$ppv), ", (", percent(Radiologist$ppv_L, suffix = ""), "-", percent(Radiologist$ppv_H), ")")
Radiologist$NPV <- paste0(percent(Radiologist$npv), ", (", percent(Radiologist$npv_L, suffix = ""), "-", percent(Radiologist$npv_H), ")")
write.csv(Radiologist, "Results/Radiologist.csv", row.names = FALSE)
rm(probability_trans(, rval, SubgroupPlot))
rm(Probably, rval, SubgroupPlot))
rm(Probably, rval, SubgroupPlot)
rm(Any, Highly)
########### Human vs AI ####################
CAD_Xpert_plot <- read.csv("Results/CAD_Xpert_CAD6.3.csv")
View(CAD_Xpert_plot)
CAD_Xpert_plot <- subset(CAD_Xpert_plot, CAD_Xpert_plot$Site %in% "BGD")
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
names(CAD_Xpert_plot)
AI <- CAD_Xpert_plot[CAD_Xpert_plot$Comment !="" , c(17, 14, 4, 24, 25, 18,27,28, 7:12, 29,30)]
AI$Subject <- paste(AI$DeepLearningSystem, AI$Comment)
require(data.table)
AI <- as.data.table(AI)
# # knitr::kable(AI[AI[, .I[which.max(Spec)], by=Subject]$V1])
AI <- AI[AI[, .I[which.max(Spec)], by=Subject]$V1]
AI <- AI[grep("Radiologists' ", AI$Comment), ]
View(AI)
names(Radiologist)
View(Human)
# knitr::kable(Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11)])
# Human <- Radiologist[(Radiologist$Referral %in% "MDF"), c(8, 10, 11, 4)]
Human <- Radiologist[(Radiologist$Referral %in% "MDF"), ]
Human <- Human[c(3,2,1), ]
Human <- rbind(Human, Human, Human, Human, Human)
humanAI <- cbind(Human, AI)
View(humanAI)
names(humanAI)
write.csv(humanAI, "Results/HumanAI.csv", row.names = F)
rm(AI, Human, HumanAI)
rm(AI, Human, humanAI)
humanAI <- read_csv("Results/humanAI.csv")
View(humanAI)
humanAI <- read_csv("Results/humanAI.csv")
humanAI <- read_csv("Results/humanAI.csv")
humanAI$specD <- percent(humanAI$AI_Spec- humanAI$Huan_Spec)
View(humanAI)
humanAI$PPVD <- percent(humanAI$AI_PPV- humanAI$Huan_PPV)
humanAI$NPVD <- percent(humanAI$AI_NPV- humanAI$Huan_NPV)
View(humanAI)
humanAI$specCI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$AI_Spec[i]*healthy, healthy*humanAI$Huan_Spec[i]), n=c(healthy, healthy))
humanAI$specCI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$PPVCI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$AI_PPV[i]*healthy, healthy*humanAI$Huan_PPV[i]), n=c(healthy, healthy))
humanAI$PPVCI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$NPVCI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$AI_NPV[i]*healthy, healthy*humanAI$Huan_NPV[i]), n=c(healthy, healthy))
humanAI$NPVCI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
### McNemar test specificity
healthy <- sum(MDF$Xpert2Outcome_num %in% "0")
humanAI$specCI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$AI_Spec[i]*healthy, healthy*humanAI$Huan_Spec[i]), n=c(healthy, healthy))
humanAI$specCI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$PPVCI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$AI_PPV[i]*healthy, healthy*humanAI$Huan_PPV[i]), n=c(healthy, healthy))
humanAI$PPVCI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
humanAI$NPVCI <- ""
for (i in 1:15){
test <- prop.test(x=c(humanAI$AI_NPV[i]*healthy, healthy*humanAI$Huan_NPV[i]), n=c(healthy, healthy))
humanAI$NPVCI[i] <- paste0(percent(test$conf.int[1], suffix = ""), "-", percent(test$conf.int[2]))
# return(humanAI)
}
write.csv(humanAI, "Results/table4.csv", row.names = F)
source("DataWrangling/GlobalOption.R")
source("radiologist.R")
Radiologist <- Radiologist[Radiologist$Referral %in% "MDF", ]
New <- MDF[MDF$TB.Medication.History %in% "No",]
Old <- MDF[MDF$TB.Medication.History %in% "Yes",]
Female <- MDF[MDF$Gender %in% "F", ]
Male <- MDF[MDF$Gender %in% "M", ]
Young <- MDF[MDF$AgeGroup %in% "[15,25)",]
Middle <- MDF[MDF$AgeGroup %in% "[25,60)",]
Senior <- MDF[MDF$AgeGroup %in% "[60,108]",]
PrivateReferral <-subset(MDF, MDF$UseCase %in% "PrivateReferral")
PublicReferral <-subset(MDF, MDF$UseCase %in% "PublicReferral")
DOTS <-subset(MDF, MDF$UseCase %in% "PublicDOTSRetesting")
WalkIn <-subset(MDF, MDF$UseCase %in% "WalkIn")
Community <-subset(MDF, MDF$UseCase %in% "Community screening")
Contacts <-subset(MDF, MDF$UseCase %in% "Contacts")
# Missing <- subset(MDF, is.na(MDF$UseCase)==T)
New_long <- MDF_long[MDF_long$TB.Medication.History %in% "No",]
Old_long <- MDF_long[MDF_long$TB.Medication.History %in% "Yes",]
Young_long <- MDF_long[MDF_long$AgeGroup %in% "[15,25)",]
Middle_long <- MDF_long[MDF_long$AgeGroup %in% "[25,60)",]
Senior_long <- MDF_long[MDF_long$AgeGroup %in% "[60,108]",]
PrivateReferral_long <-subset(MDF_long, MDF_long$UseCase %in% "PrivateReferral")
PublicReferral_long <-subset(MDF_long, MDF_long$UseCase %in% "PublicReferral")
DOTS_long <-subset(MDF_long, MDF_long$UseCase %in% "PublicDOTSRetesting")
WalkIn_long <-subset(MDF_long, MDF_long$UseCase %in% "WalkIn")
Community_long <-subset(MDF_long, MDF_long$UseCase %in% "Community screening")
Contacts_long <-subset(MDF_long, MDF_long$UseCase %in% "Contacts")
# Missing <- subset(MDF_long, is.na(MDF_long$UseCase)==T)
source("DataWrangling/GlobalOption.R")
source("radiologist.R")
Radiologist <- Radiologist[Radiologist$Referral %in% "MDF", ]
New <- MDF[MDF$TB.Medication.History %in% "No",]
Old <- MDF[MDF$TB.Medication.History %in% "Yes",]
Female <- MDF[MDF$Gender %in% "F", ]
Male <- MDF[MDF$Gender %in% "M", ]
Young <- MDF[MDF$AgeGroup %in% "[15,25)",]
Middle <- MDF[MDF$AgeGroup %in% "[25,60)",]
Senior <- MDF[MDF$AgeGroup %in% "[60,108]",]
PrivateReferral <-subset(MDF, MDF$UseCase %in% "PrivateReferral")
PublicReferral <-subset(MDF, MDF$UseCase %in% "PublicReferral")
summary(MDF$UseCase)
PublicReferral <-subset(MDF, MDF$UseCase %in% "PublicReferral")
MDF$UseCase %in% "PublicReferral"
table(MDF$UseCase)
MDF$UseCase == "PublicReferral"
str(MDF$UseCase)
source("DataWrangling/GlobalOption.R")
New <- MDF[MDF$TB.Medication.History %in% "No",]
Old <- MDF[MDF$TB.Medication.History %in% "Yes",]
Female <- MDF[MDF$Gender %in% "F", ]
Male <- MDF[MDF$Gender %in% "M", ]
Young <- MDF[MDF$AgeGroup %in% "[15,25)",]
Middle <- MDF[MDF$AgeGroup %in% "[25,60)",]
Senior <- MDF[MDF$AgeGroup %in% "[60,108]",]
PrivateReferral <-subset(MDF, MDF$UseCase %in% "PrivateReferral")
PublicReferral <-subset(MDF, MDF$UseCase %in% "PublicReferral")
PublicReferral_long <-subset(MDF_long, MDF_long$UseCase %in% "PublicReferral")
